<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Trận chiến đấu đánh điểm</title>

<style>
  body{
    margin:0;
    background:white;
    font-family:Arial, sans-serif;
    background:
  radial-gradient(ellipse at 12% 18%, rgba(255,215,235,0.9) 0 12%, transparent 45%),
  radial-gradient(ellipse at 82% 22%, rgba(255,250,210,0.85) 0 14%, transparent 48%),
  radial-gradient(ellipse at 35% 85%, rgba(210,255,235,0.85) 0 16%, transparent 55%),
  radial-gradient(ellipse at 95% 95%, rgba(230,240,255,0.8) 0 14%, transparent 50%),
  linear-gradient(180deg, #fff6ef 0%, #f3fff8 60%, #effff7 100%);
  }

  /* Thanh player */
  .player-bar{
    position:fixed;
    bottom:0;
    width:100%;
    background:#5fa8ad;
    padding:18px 0;
    display:flex;
    justify-content:center;
    align-items:center;
    gap:16px;
    box-shadow:0 -4px 10px rgba(0,0,0,0.1);
    z-index:30;
  }

  .circle-btn{
    width:60px;
    height:60px;
    border-radius:50%;
    border:none;
    background:rgba(255,255,255,0.25);
    backdrop-filter:blur(5px);
    display:flex;
    justify-content:center;
    align-items:center;
    cursor:pointer;
    transition:0.18s;
  }

  .circle-btn:hover{
    background:rgba(255,255,255,0.4);
    transform:scale(1.05);
  }

  .play-btn{
    width:75px;
    height:75px;
    background:rgba(255,255,255,0.35);
  }

  .circle-btn svg{
    width:26px;
    height:26px;
    fill:#083c3f;
  }

  .play-btn svg{
    width:32px;
    height:32px;
  }

  /* Fullscreen playlist overlay */
  .playlist-overlay{
    position:fixed;
    inset:0; /* top:0; right:0; bottom:0; left:0; */
    background:rgba(4,12,14,0.6);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:100;
    padding:20px;
    backdrop-filter: blur(4px);
    animation: fadeIn 180ms ease;
  }

  .playlist-overlay.open{
    display:flex;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.995); }
    to   { opacity: 1; transform: scale(1); }
  }

  /* Playlist modal content */
  .playlist-modal{
    width:100%;
    max-width:900px;
    max-height:90%;
    background:#ffffff;
    border-radius:12px;
    box-shadow:0 10px 30px rgba(0,0,0,0.25);
    overflow:hidden;
    display:flex;
    flex-direction:column;
    position:relative;
  }

  .playlist-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:14px 18px;
    border-bottom:1px solid rgba(8,60,63,0.06);
    background:linear-gradient(90deg, rgba(95,168,173,0.03), rgba(95,168,173,0.01));
  }

  .playlist-header h4{
    margin:0;
    color:#083c3f;
    font-size:18px;
  }

  .close-btn{
    background:transparent;
    border:none;
    font-size:20px;
    cursor:pointer;
    padding:8px;
    border-radius:8px;
  }

  .close-btn:hover{
    background:rgba(0,0,0,0.06);
  }

  .playlist-body{
    padding:12px;
    overflow:auto;
    flex:1;
  }

  .playlist-list{
    list-style:none;
    margin:0;
    padding:0;
    display:flex;
    flex-direction:column;
    gap:8px;
  }

  .playlist-list li{
    padding:12px;
    border-radius:8px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    cursor:pointer;
    transition:0.12s;
    background:linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,0));
  }

  .playlist-list li:hover{
    background:rgba(95,168,173,0.06);
    transform: translateY(-1px);
  }

  .playlist-list li.active{
    background:linear-gradient(90deg, rgba(95,168,173,0.12), rgba(95,168,173,0.06));
    border-left:4px solid #08585a;
  }

  .track-info{
    display:flex;
    flex-direction:column;
  }

  .track-title{
    font-weight:600;
    color:#063233;
  }

  .track-sub{
    font-size:12px;
    color:#6b7a7a;
  }

  /* Main content styling (giữ giống trang chính) */
  main{
    padding-bottom:120px; /* cho chừa chỗ player */
  }
  .content_main{
    margin-top: 40px;
    text-align:center;
  }
  .content_main h1{
    margin:8px 0;
    color:#b30b0b;
  }
 .hero-img{
    width:70%;
    height:auto;
    object-fit:cover;
    margin-bottom:10px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 20px auto;
  }
  .content{
    max-width:1000px;
    margin:0 auto 60px;
    padding:0 12px;
  }
  .content p{
    font-style: italic;
    text-indent: 1.5em;
    margin:10px 5px;
  }

  /* Responsive */
  @media(max-width:600px){
    .circle-btn{width:38px;height:38px;}
    .play-btn{width:64px;height:64px;}
    .playlist-modal{max-width:100%; max-height:100%; border-radius:8px;}
    .playlist-header h4{font-size:16px;}
    .hero-img{height:auto;width: 100%;}
  }
</style>
</head>

<body>

<div class="player-bar">

  <!-- Previous -->
  <button class="circle-btn" id="prev" title="Previous" aria-label="Previous">
    <svg viewBox="0 0 24 24">
      <polygon points="11,12 18,18 18,6"/>
      <rect x="6" y="6" width="2" height="12"/>
    </svg>
  </button>

  <!-- Play -->
  <button class="circle-btn play-btn" id="play" title="Play / Pause" aria-label="Play / Pause">
    <svg id="playIcon" viewBox="0 0 24 24">
      <polygon points="8,5 19,12 8,19"/>
    </svg>
  </button>

  <!-- Next -->
  <button class="circle-btn" id="next" title="Next" aria-label="Next">
    <svg viewBox="0 0 24 24">
      <polygon points="13,12 6,6 6,18"/>
      <rect x="16" y="6" width="2" height="12"/>
    </svg>
  </button>

  <!-- Volume -->
  <button class="circle-btn" id="volumeBtn" title="Mute" aria-label="Mute">
    <svg viewBox="0 0 24 24">
      <polygon points="3,9 7,9 12,5 12,19 7,15 3,15"/>
      <path d="M16 8 Q20 12 16 16" stroke="#083c3f" stroke-width="2" fill="none"/>
    </svg>
  </button>

  <!-- Repeat -->
  <button class="circle-btn" id="repeat" title="Repeat current" aria-label="Repeat">
    <svg viewBox="0 0 24 24">
      <path d="M7 7h10v3l4-4-4-4v3H5v6" fill="#083c3f"/>
      <path d="M17 17H7v-3l-4 4 4 4v-3h12v-6" fill="#083c3f"/>
    </svg>
  </button>

  <!-- Menu -->
  <button class="circle-btn" id="menuBtn" title="Menu / Playlist" aria-label="Menu / Playlist">
    <svg viewBox="0 0 24 24">
      <rect x="4" y="6" width="16" height="2"/>
      <rect x="4" y="11" width="16" height="2"/>
      <rect x="4" y="16" width="10" height="2"/>
    </svg>
  </button>

</div>

<main>
  <div class="content_main">
     <h4 style="font-size: clamp(10px, 5vw, 20px);color: red;text-align: center;">TRẬN CHIẾN ĐẤU ĐÁNH ĐIỂM, DIỆT VIỆN PHƯƠNG ĐIẾM- ĐƯỜNG 17 CỦA TRUNG ĐOÀN 42 TRUNG DŨNG</h4>
  </div>

  <!-- ảnh bìa riêng cho đề mục 1 -->
  <img class="hero-img" src="./img/8.jpg" alt="Đề mục 1 - bìa">
 <h4 style="color:rgb(131, 8, 8); margin:4px 0;text-align: center;text-transform: uppercase;font-size: clamp(10px, 5vw, 20px);">Sa bàn trận đánh</h4>
  <div class="content">
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Kính thưa thủ trưởng,</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Kính thưa toàn thể các đồng chí!</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Thủ trưởng và các đồng chí đang tham quan sa bàn tái hiện trận chiến đấu đánh điểm, diệt viện Phương Điếm- Đường 17 của Trung đoàn 42 Trung Dũng.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: 700;">Về hoàn cảnh và tình hình trước trận đánh</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Ngày 6 tháng 12 năm 1953, Tổng Quân ủy trình Bộ Chính trị “Phương án tác chiến mùa xuân năm 1954”, xác định quyết tâm mở Chiến dịch Điện Biên Phủ nhằm tiêu diệt tập đoàn cứ điểm mạnh nhất của thực dân Pháp ở Tây Bắc, tạo bước ngoặt quyết định trên chiến trường Đông Dương. Từ ngày 13 tháng 3 đến ngày 7 tháng 5 năm 1954, Chiến dịch Điện Biên Phủ diễn ra và kết thúc toàn thắng, buộc thực dân Pháp phải chấp nhận thất bại chiến lược. Tuy nhiên, để bảo đảm cho chiến trường chính giành thắng lợi, Trung ương Đảng và Tổng Quân ủy đồng thời chỉ đạo các chiến trường phối hợp phải đẩy mạnh hoạt động tiến công, phân tán, kìm chân và tiêu hao sinh lực địch, không để chúng tập trung lực lượng chi viện cho Điện Biên Phủ.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Thực hiện chủ trương đó, Khu Tả Ngạn được giao nhiệm vụ phối hợp chặt chẽ với chiến trường Tây Bắc, mở các đợt hoạt động mạnh trong vùng đồng bằng, đặc biệt trên các tuyến giao thông chiến lược. Suốt mùa xuân năm 1953- 1954, Trung đoàn 42 cùng các đơn vị chủ lực khác đã hiệp đồng chặt chẽ với bộ đội địa phương, dân quân du kích, triển khai đấu tranh toàn diện trên các mặt quân sự, chính trị, kinh tế, văn hóa. Với phương châm “tích cực, chủ động, cơ động, linh hoạt”, ta liên tiếp mở nhiều trận đánh có quy mô chiến dịch nhỏ, từng bước uy hiếp và tiến tới phá vỡ phòng tuyến quốc lộ số 5, tuyến đường sắt Hà Nội- Hải Phòng, cô lập các thị xã Hải Dương, Hưng Yên, Ninh Giang, làm rung chuyển hệ thống phòng thủ của địch tại đồng bằng Bắc Bộ.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Trong thế bố trí phòng ngự của địch tại khu vực Hải Dương, vị trí Phương Điếm giữ vai trò quan trọng trong hệ thống chỉ huy và bảo vệ thị xã. Đây là một cứ điểm then chốt, góp phần bảo đảm an toàn cho cụm phòng ngự trung tâm, đồng thời duy trì khả năng cơ động ứng cứu qua tuyến Đường 17 khi bị tiến công. Nếu giữ được Phương Điếm, địch có thể nhanh chóng điều lực lượng tăng viện, củng cố thế phòng ngự liên hoàn; ngược lại, nếu vị trí này bị tiêu diệt và lực lượng ứng cứu bị đánh bại, toàn bộ hệ thống bảo vệ khu vực Hải Dương sẽ bị rung chuyển nghiêm trọng.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Xuất phát từ yêu cầu chiến lược phối hợp với Chiến dịch Điện Biên Phủ và nhiệm vụ cụ thể trên địa bàn Khu Tả Ngạn, ngày 6 tháng 12 năm 1953, dưới sự chỉ huy trực tiếp của Trung đoàn trưởng Nguyễn Như Thiết, Trung đoàn 42 được lệnh tiến công đánh chiếm Phương Điếm, đồng thời sẵn sàng tổ chức phục kích trên Đường 17 để tiêu diệt lực lượng tiếp viện nếu địch đưa quân giải vây. Nhiệm vụ đặt ra không chỉ là tiêu diệt một cứ điểm, mà còn phải giáng một đòn mạnh vào hệ thống cơ động ứng cứu của đối phương, qua đó góp phần phân tán và làm suy yếu lực lượng địch trên toàn chiến trường.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Trận đánh Phương Điếm vì thế không chỉ là một trận công kiên đơn thuần, mà là một mắt xích quan trọng trong thế trận phối hợp chiến lược với Chiến dịch Điện Biên Phủ, đồng thời đánh dấu bước trưởng thành của Trung đoàn 42 trong tổ chức chỉ huy và vận dụng cách đánh “đánh điểm, diệt viện” trên chiến trường đồng bằng.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;font-weight: 700;">Diễn biến chính của trận đánh</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Thực hiện quyết tâm tác chiến đã được xác định, ngày 6 tháng 12 năm 1953, dưới sự chỉ huy trực tiếp của Trung đoàn trưởng Nguyễn Như Thiết, Trung đoàn 42 nổ súng tiến công vị trí Phương Điếm- một cứ điểm quan trọng trong hệ thống phòng thủ bảo vệ thị xã Hải Dương. Đây là trận đánh mở đầu đợt hoạt động phối hợp với Chiến dịch Điện Biên Phủ trên địa bàn Khu Tả Ngạn, đồng thời là trận công kiên có quy mô lớn nhất của Trung đoàn kể từ khi thành lập.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Với sự chuẩn bị chu đáo và tinh thần quyết tâm cao, các mũi tiến công nhanh chóng áp sát mục tiêu, triển khai hỏa lực chế áp, phá vỡ hệ thống đề kháng của địch. Đòn tiến công được tổ chức dứt khoát, táo bạo, tạo thế bất ngờ khiến quân địch không kịp củng cố đội hình phòng ngự. Trong quá trình chiến đấu, ta đồng thời chủ động triển khai lực lượng phục kích trên trục Đường 17, sẵn sàng đánh lực lượng tiếp viện khi chúng cơ động đến giải vây.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Đúng như dự kiến, khi Phương Điếm bị tiến công, địch tổ chức lực lượng cơ động ứng cứu. Tuy nhiên, đội hình tiếp viện vừa triển khai đã rơi vào trận địa phục kích của ta trên Đường 17. Các đơn vị nhanh chóng nổ súng đánh thẳng vào đội hình cơ giới, làm rối loạn thế triển khai của địch, chia cắt và tiêu diệt từng bộ phận. Sự hiệp đồng chặt chẽ giữa lực lượng công đồn và lực lượng phục kích đã tạo nên thế trận hoàn chỉnh của cách đánh “đánh điểm, diệt viện”, khiến địch không kịp trở tay.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Toàn bộ trận công đồn kết hợp diệt viện diễn ra trong vòng 30 phút, nhưng kết quả đạt được hết sức to lớn. Ta tiêu diệt tên quan ba Ca-muýt cùng 330 tên địch, bắt sống 88 tên, phá hủy 2 xe tăng và 6 xe cơ giới, thu nhiều vũ khí và phương tiện chiến tranh. Phía ta có 55 đồng chí hy sinh, 161 đồng chí bị thương, thể hiện tinh thần chiến đấu dũng cảm, sẵn sàng hy sinh vì nhiệm vụ.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;font-weight: 700;">Kết quả trận đánh, ý nghĩa lịch sử và bài học kinh nghiệm</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Chiến thắng Phương Điếm- Đường 17 ngày 6 tháng 12 năm 1953 đã mang lại kết quả quân sự trực tiếp hết sức quan trọng. Trong thời gian chiến đấu ngắn gọn 30 phút, Trung đoàn 42 đã tiêu diệt tên quan ba Ca-muýt cùng 330 tên địch, bắt sống 88 tên, phá hủy 2 xe tăng và 6 xe cơ giới, thu nhiều vũ khí, phương tiện chiến tranh. Việc đánh chiếm Phương Điếm và tiêu diệt lực lượng tiếp viện trên Đường 17 đã làm rung chuyển hệ thống phòng thủ bảo vệ thị xã Hải Dương, góp phần uy hiếp phòng tuyến quốc lộ số 5 và tuyến đường sắt Hà Nội- Hải Phòng, tạo điều kiện thuận lợi cho các hoạt động tiến công tiếp theo của ta trên địa bàn Khu Tả Ngạn.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Về ý nghĩa chiến lược, trận đánh không chỉ đơn thuần là một thắng lợi cấp trung đoàn, mà còn là một mắt xích quan trọng trong thế trận phối hợp với Chiến dịch Điện Biên Phủ. Trong khi chiến trường chính ở Tây Bắc chuẩn bị bước vào cuộc quyết chiến chiến lược, các chiến trường phối hợp, trong đó có Khu Tả Ngạn, đã hoàn thành tốt nhiệm vụ phân tán, kìm chân và tiêu hao sinh lực địch, buộc chúng không thể điều lực lượng cơ động tăng cường cho Điện Biên Phủ. Chiến thắng Phương Điếm vì thế góp phần thiết thực vào thắng lợi chung của cuộc kháng chiến trong giai đoạn quyết định.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Đối với Trung đoàn 42, đây là trận đánh có quy mô lớn nhất kể từ ngày thành lập, đánh dấu bước trưởng thành vượt bậc về năng lực tổ chức chỉ huy và vận dụng nghệ thuật tác chiến. Việc kết hợp chặt chẽ giữa công đồn và phục kích diệt viện, xử lý tình huống nhanh gọn, hiệp đồng nhịp nhàng giữa các bộ phận đã thể hiện rõ trình độ tác chiến ngày càng vững vàng của đơn vị. Thực tiễn trận đánh cho thấy khi nắm chắc tình hình địch, chuẩn bị chu đáo, giữ vững yếu tố bất ngờ và triển khai lực lượng quyết đoán, ta có thể tạo ra hiệu quả chiến đấu rất cao trong thời gian ngắn.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Tuy phải chịu tổn thất với 55 đồng chí hy sinh và 161 đồng chí bị thương, song sự hy sinh anh dũng của cán bộ, chiến sĩ đã làm nên thắng lợi chung, góp phần bồi đắp truyền thống chiến đấu kiên cường của Trung đoàn. Những kinh nghiệm quý báu rút ra từ trận đánh Phương Điếm- Đường 17, đặc biệt là kinh nghiệm về cách đánh “đánh điểm, diệt viện” trong điều kiện đồng bằng có hệ thống giao thông thuận lợi cho địch cơ động, đã được đơn vị nghiên cứu, vận dụng hiệu quả trong các trận công kiên và hoạt động tiến công tiếp theo.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Chiến thắng Phương Điếm vì vậy không chỉ là một dấu mốc quan trọng trong quá trình hoạt động của Trung đoàn 42, mà còn là minh chứng sinh động cho tinh thần chủ động, sáng tạo và quyết chiến quyết thắng của bộ đội ta trong cao trào phối hợp với Chiến dịch Điện Biên Phủ lịch sử.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Trân trọng cảm ơn thủ trưởng và các đồng chí đã tham quan sa bàn tái hiện trận chiến đấu đánh điểm, diệt viện Phương Điếm- Đường 17 của Trung đoàn 42 Trung Dũng.</p>
  </div>
</main>

<!-- Fullscreen Playlist Overlay -->
<div class="playlist-overlay" id="playlistOverlay" aria-hidden="true" role="dialog" aria-label="Playlist">
  <div class="playlist-modal" role="document" id="playlistModal">
    <div class="playlist-header">
      <h4>Playlist</h4>
      <div>
        <button class="close-btn" id="closeBtn" aria-label="Đóng playlist">✕</button>
      </div>
    </div>

    <div class="playlist-body" id="playlistBody">
      <ul class="playlist-list" id="trackList">
        <!-- JS tạo danh sách -->
      </ul>
    </div>
  </div>
</div>

<!-- Audio element -->
<audio id="audio" preload="none"></audio>

<script>
/* === CHỈ SỬA / THÊM Ở ĐÂY: logic để trang biết mình đang ở mục nào và autoplay ===
   Mọi HTML/CSS bên ngoài không thay đổi.
*/

/* Danh sách bài đầy đủ (giữ cấu trúc page giống file của bạn) */
const tracks = [
  // ví dụ: track 1 có page -> khi prev/next tới track 1 sẽ điều hướng
  { title: "Giới thiệu tổng quan", src: "./audio/giới thiệu.mp3", content:"Giới thiệu", page: "./gioithieu.html" },
  { title: "Đề mục 1- Không gian khánh tiết", src: "./audio/3. Đề mục 1- Không gian khánh tiết.mp3", content:"Không gian khánh tiết", page: "./khonggiankhanhtiet.html" },
  { title: "Đề mục 2- Lịch sử hình thành, phát triển Trung đoàn", src: "./audio/4. Đề mục 2- Lịch sử hình thành, phát triển Trung đoàn.mp3", content:"Giới thiệu", page: "lichsuhinhthanh.html" },
  { title: "Mảng ảnh 1- Đề mục 2 giai đoạn 1946-1954",  src: "./audio/5. Mảng ảnh 1- Đề mục 2.mp3",  content:"Đề mục 1", page: "./demuc1.html" },
  { title: "Mảng ảnh 2- Đề mục 2 giai đoạn 1955-1971",  src: "./audio/6. Mảng ảnh 2- Đề mục 2.mp3", content:"Đề mục 2", page: "./demuc2.html" },
  { title: "Mảng ảnh 3- Đề mục 2 giai đoạn 1971-1975",  src: "./audio/7. Mảng ảnh 3- Đề mục 2.mp3",  content:"Đề mục 3", page: "./demuc3.html" },
  { title: "Mảng ảnh 4- Đề mục  giai đoạn 1976-1979",  src: "./audio/8. Mảng ảnh 4- Đề mục 2.mp3", content:"Đề mục 4", page: "./demuc4.html" },
  { title: "Mảng ảnh 5- Đề mục 2 giai đoạn 1979-1988",  src: "./audio/9. Mảng ảnh 5- Đề mục 2.mp3",  content:"Đề mục 5", page: "./demuc5.html" },
  { title: "Mảng ảnh 6- Đề mục 2 giai đoạn 1988-2020",  src: "./audio/10. Mảng ảnh 6- Đề mục 2.mp3", content:"Đề mục 6", page: "./demuc6.html" },
  { title: "Mảng ảnh 7- Đề mục 2 giai đoạn 2020 đến nay",  src: "./audio/11. Mảng ảnh 7- Đề mục 2.mp3",  content:"Đề mục 7", page: "./demuc7.html" },
  { title: "Đề mục 3- Trận đánh điểm diệt viện",  src: "./audio/12. Đề mục 3- Trận đánh điểm diệt viện.mp3", content:"sa bàn", page: "./saban.html" },
  { title: "Đề mục 3- Trận đánh Sân bay Tân Sơn Nhất",  src: "./audio/13. Đề mục 3- Trận đánh Sân bay Tân Sơn Nhất.mp3", content:"tân sơn nhất", page: "./tansonnhat.html" },
  { title: "Đề mục 4- Hiện vật lịch sử",  src: "./audio/14. Đề mục 4- Hiện vật lịch sử .mp3", content:"tân sơn nhất", page: "./hienvatlichsu.html" },
  { title: "Đề mục 5- Phần thưởng cao quý",  src: "./audio/15. Đề mục 5- Phần thưởng cao quý.mp3", content:"tân sơn nhất", page: "./phanthuongcaoquy.html" },
];

/* DOM elements (không đổi) */
const audio = document.getElementById("audio");
const playBtn = document.getElementById("play");
const playIcon = document.getElementById("playIcon");
const repeatBtn = document.getElementById("repeat");
const prevBtn = document.getElementById("prev");
const nextBtn = document.getElementById("next");
const volumeBtn = document.getElementById("volumeBtn");
const menuBtn = document.getElementById("menuBtn");

const playlistOverlay = document.getElementById("playlistOverlay");
const playlistModal = document.getElementById("playlistModal");
const closeBtn = document.getElementById("closeBtn");
const trackListEl = document.getElementById("trackList");

let currentIndex = 0;
let isRepeat = false;

/* Helper: lấy tên file hiện tại (không bao gồm query string) */
function currentFilename() {
  const path = location.pathname;
  const file = path.split('/').pop();
  return file || 'index.html';
}

/* Helper: đọc query param */
function getQueryParam(name) {
  return new URLSearchParams(location.search).get(name);
}

/* Helper: thêm ?autoplay=1 nếu cần */
function addAutoplayParam(page, autoplay) {
  if (!autoplay) return page;
  return page + (page.includes('?') ? '&' : '?') + 'autoplay=1';
}

/* --- render playlist (giữ giống cấu trúc ban đầu) --- */
function renderPlaylist() {
  trackListEl.innerHTML = "";
  tracks.forEach((t, i) => {
    const li = document.createElement("li");
    li.dataset.index = i;

    const info = document.createElement("div");
    info.className = "track-info";

    const title = document.createElement("div");
    title.className = "track-title";
    title.textContent = t.title + (t.page ? " ▸" : "");

    const sub = document.createElement("div");
    sub.className = "track-sub";
    sub.textContent = `Bài ${i+1}`;

    info.appendChild(title);
    info.appendChild(sub);

    const btns = document.createElement("div");
    btns.style.display = "flex";
    btns.style.gap = "8px";
    btns.style.alignItems = "center";

    const playNow = document.createElement("button");
    playNow.className = "circle-btn";
    playNow.style.width = "40px";
    playNow.style.height = "40px";
    playNow.title = "Phát";
    playNow.ariaLabel = "Phát";
    playNow.innerHTML = '<svg viewBox="0 0 24 24" style="width:18px;height:18px;fill:#083c3f;"><polygon points="8,5 19,12 8,19"/></svg>';
    playNow.addEventListener("click", (ev) => {
      ev.stopPropagation();
      loadTrack(i, true);
    });

    btns.appendChild(playNow);
    li.appendChild(info);
    li.appendChild(btns);

    li.addEventListener("click", () => {
      const track = tracks[i];
      if (track.page) {
        // nếu có page -> điều hướng kèm autoplay để trang đích tự phát
        window.location.href = addAutoplayParam(track.page, true);
      } else {
        loadTrack(i, true);
        closePlaylist();
      }
    });

    trackListEl.appendChild(li);
  });
}

/* Highlight hiện tại */
function highlightCurrent() {
  const items = trackListEl.querySelectorAll("li");
  items.forEach(li => li.classList.remove("active"));
  const cur = trackListEl.querySelector(`li[data-index="${currentIndex}"]`);
  if (cur) cur.classList.add("active");
}

/* Load track theo index */
function loadTrack(index, playNow = false) {
  if (index < 0 || index >= tracks.length) return;
  currentIndex = index;
  audio.src = tracks[currentIndex].src;
  highlightCurrent();
  if (playNow) {
    audio.play().catch(()=>{/* bị chặn autoplay có thể xảy ra */});
    setPlayIcon(true);
  } else {
    setPlayIcon(false);
  }
}

/* Play/pause */
function togglePlay() {
  if (audio.paused) {
    audio.play().catch(()=>{});
    setPlayIcon(true);
  } else {
    audio.pause();
    setPlayIcon(false);
  }
}

/* Hiển thị icon play/pause */
function setPlayIcon(playing) {
  if (playing) {
    playIcon.innerHTML = '<rect x="7" y="6" width="3" height="12"/><rect x="14" y="6" width="3" height="12"/>';
  } else {
    playIcon.innerHTML = '<polygon points="8,5 19,12 8,19"/>';
  }
}

/* Prev/Next: wrap-around; nếu target có page -> điều hướng kèm autoplay */
function prevTrack(){
  let newIndex = currentIndex - 1;
  if (newIndex < 0) newIndex = tracks.length - 1; // wrap to last
  const target = tracks[newIndex];
  if (target && target.page) {
    window.location.href = addAutoplayParam(target.page, true);
  } else {
    loadTrack(newIndex, true);
  }
}

function nextTrack(){
  let newIndex = currentIndex + 1;
  if (newIndex >= tracks.length) newIndex = 0; // wrap to first
  const target = tracks[newIndex];
  if (target && target.page) {
    window.location.href = addAutoplayParam(target.page, true);
  } else {
    loadTrack(newIndex, true);
  }
}

/* Khi audio kết thúc */
audio.addEventListener("ended", ()=>{
  if (isRepeat) {
    audio.currentTime = 0;
    audio.play();
    return;
  }
  const nextIndex = (currentIndex + 1) % tracks.length;
  const target = tracks[nextIndex];
  if (target && target.page) {
    window.location.href = addAutoplayParam(target.page, true);
  } else {
    loadTrack(nextIndex, true);
  }
});

/* Repeat toggle */
repeatBtn.onclick = ()=> {
  isRepeat = !isRepeat;
  audio.loop = false;
  repeatBtn.style.background = isRepeat ? "rgba(255,255,255,0.6)" : "rgba(255,255,255,0.25)";
};

/* Hook up buttons */
playBtn.onclick = togglePlay;
prevBtn.onclick = prevTrack;
nextBtn.onclick = nextTrack;

volumeBtn.onclick = ()=> {
  audio.muted = !audio.muted;
  volumeBtn.style.background = audio.muted ? "rgba(255,255,255,0.6)" : "rgba(255,255,255,0.25)";
};

/* Playlist open/close */
menuBtn.onclick = (e)=> { e.stopPropagation(); openPlaylist(); };
closeBtn.onclick = (e)=> { e.stopPropagation(); closePlaylist(); };

function openPlaylist(){
  playlistOverlay.classList.add("open");
  playlistOverlay.setAttribute("aria-hidden", "false");
  closeBtn.focus();
}

function closePlaylist(){
  playlistOverlay.classList.remove("open");
  playlistOverlay.setAttribute("aria-hidden", "true");
  menuBtn.focus();
}

/* Click ngoài modal đóng */
playlistOverlay.addEventListener("click", (e) => {
  if(!playlistModal.contains(e.target)) closePlaylist();
});
playlistModal.addEventListener("click", (e) => e.stopPropagation());

/* Keyboard */
document.addEventListener("keydown", (e)=>{
  if(e.code === "Space") { e.preventDefault(); togglePlay(); }
  else if (e.key && e.key.toLowerCase() === "m") { audio.muted = !audio.muted; volumeBtn.style.background = audio.muted ? "rgba(255,255,255,0.6)" : "rgba(255,255,255,0.25)"; }
  else if (e.code === "ArrowRight") nextTrack();
  else if (e.code === "ArrowLeft") prevTrack();
  else if (e.code === "Escape" && playlistOverlay.classList.contains("open")) closePlaylist();
});

/* === INIT: render playlist, detect current page, set currentIndex, autoplay nếu có param === */
function init() {
  renderPlaylist();

  const file = currentFilename(); // ex: demuc1.html
  // tìm track có page trùng file (so sánh basename)
  const idx = tracks.findIndex(t => t.page && t.page.split('/').pop() === file);
  currentIndex = (idx >= 0) ? idx : 0;

  highlightCurrent();

  const shouldAuto = getQueryParam('autoplay') === '1';
  loadTrack(currentIndex, shouldAuto);
}

init();

/* === KẾT THÚC PHẦN SCRIPT SỬA === */
</script>

</body>
</html>
