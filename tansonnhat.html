<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Trận đánh tân sơn nhất</title>

<style>
  body{
    margin:0;
    background:white;
    font-family:Arial, sans-serif;
    background:
  radial-gradient(ellipse at 12% 18%, rgba(255,215,235,0.9) 0 12%, transparent 45%),
  radial-gradient(ellipse at 82% 22%, rgba(255,250,210,0.85) 0 14%, transparent 48%),
  radial-gradient(ellipse at 35% 85%, rgba(210,255,235,0.85) 0 16%, transparent 55%),
  radial-gradient(ellipse at 95% 95%, rgba(230,240,255,0.8) 0 14%, transparent 50%),
  linear-gradient(180deg, #fff6ef 0%, #f3fff8 60%, #effff7 100%);
  }

  /* Thanh player */
  .player-bar{
    position:fixed;
    bottom:0;
    width:100%;
    background:#5fa8ad;
    padding:18px 0;
    display:flex;
    justify-content:center;
    align-items:center;
    gap:16px;
    box-shadow:0 -4px 10px rgba(0,0,0,0.1);
    z-index:30;
  }

  .circle-btn{
    width:60px;
    height:60px;
    border-radius:50%;
    border:none;
    background:rgba(255,255,255,0.25);
    backdrop-filter:blur(5px);
    display:flex;
    justify-content:center;
    align-items:center;
    cursor:pointer;
    transition:0.18s;
  }

  .circle-btn:hover{
    background:rgba(255,255,255,0.4);
    transform:scale(1.05);
  }

  .play-btn{
    width:75px;
    height:75px;
    background:rgba(255,255,255,0.35);
  }

  .circle-btn svg{
    width:26px;
    height:26px;
    fill:#083c3f;
  }

  .play-btn svg{
    width:32px;
    height:32px;
  }

  /* Fullscreen playlist overlay */
  .playlist-overlay{
    position:fixed;
    inset:0; /* top:0; right:0; bottom:0; left:0; */
    background:rgba(4,12,14,0.6);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:100;
    padding:20px;
    backdrop-filter: blur(4px);
    animation: fadeIn 180ms ease;
  }

  .playlist-overlay.open{
    display:flex;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.995); }
    to   { opacity: 1; transform: scale(1); }
  }

  /* Playlist modal content */
  .playlist-modal{
    width:100%;
    max-width:900px;
    max-height:90%;
    background:#ffffff;
    border-radius:12px;
    box-shadow:0 10px 30px rgba(0,0,0,0.25);
    overflow:hidden;
    display:flex;
    flex-direction:column;
    position:relative;
  }

  .playlist-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:14px 18px;
    border-bottom:1px solid rgba(8,60,63,0.06);
    background:linear-gradient(90deg, rgba(95,168,173,0.03), rgba(95,168,173,0.01));
  }

  .playlist-header h4{
    margin:0;
    color:#083c3f;
    font-size:18px;
  }

  .close-btn{
    background:transparent;
    border:none;
    font-size:20px;
    cursor:pointer;
    padding:8px;
    border-radius:8px;
  }

  .close-btn:hover{
    background:rgba(0,0,0,0.06);
  }

  .playlist-body{
    padding:12px;
    overflow:auto;
    flex:1;
  }

  .playlist-list{
    list-style:none;
    margin:0;
    padding:0;
    display:flex;
    flex-direction:column;
    gap:8px;
  }

  .playlist-list li{
    padding:12px;
    border-radius:8px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    cursor:pointer;
    transition:0.12s;
    background:linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,0));
  }

  .playlist-list li:hover{
    background:rgba(95,168,173,0.06);
    transform: translateY(-1px);
  }

  .playlist-list li.active{
    background:linear-gradient(90deg, rgba(95,168,173,0.12), rgba(95,168,173,0.06));
    border-left:4px solid #08585a;
  }

  .track-info{
    display:flex;
    flex-direction:column;
  }

  .track-title{
    font-weight:600;
    color:#063233;
  }

  .track-sub{
    font-size:12px;
    color:#6b7a7a;
  }

  /* Main content styling (giữ giống trang chính) */
  main{
    padding-bottom:120px; /* cho chừa chỗ player */
  }
  .content_main{
    margin-top: 40px;
    text-align:center;
  }
  .content_main h1{
    margin:8px 0;
    color:#b30b0b;
  }
.hero-img{
    width:70%;
    height:auto;
    object-fit:cover;
    margin-bottom:10px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 20px auto;
  }
  .content{
    max-width:1000px;
    margin:0 auto 60px;
    padding:0 12px;
  }
  .content p{
    font-style: italic;
    text-indent: 1.5em;
    margin:10px 5px;
  }

  /* Responsive */
  @media(max-width:600px){
    .circle-btn{width:38px;height:38px;}
    .play-btn{width:64px;height:64px;}
    .playlist-modal{max-width:100%; max-height:100%; border-radius:8px;}
    .playlist-header h4{font-size:16px;}
    .hero-img{height:auto; width: 100%;}
  }
</style>
</head>

<body>

<div class="player-bar">

  <!-- Previous -->
  <button class="circle-btn" id="prev" title="Previous" aria-label="Previous">
    <svg viewBox="0 0 24 24">
      <polygon points="11,12 18,18 18,6"/>
      <rect x="6" y="6" width="2" height="12"/>
    </svg>
  </button>

  <!-- Play -->
  <button class="circle-btn play-btn" id="play" title="Play / Pause" aria-label="Play / Pause">
    <svg id="playIcon" viewBox="0 0 24 24">
      <polygon points="8,5 19,12 8,19"/>
    </svg>
  </button>

  <!-- Next -->
  <button class="circle-btn" id="next" title="Next" aria-label="Next">
    <svg viewBox="0 0 24 24">
      <polygon points="13,12 6,6 6,18"/>
      <rect x="16" y="6" width="2" height="12"/>
    </svg>
  </button>

  <!-- Volume -->
  <button class="circle-btn" id="volumeBtn" title="Mute" aria-label="Mute">
    <svg viewBox="0 0 24 24">
      <polygon points="3,9 7,9 12,5 12,19 7,15 3,15"/>
      <path d="M16 8 Q20 12 16 16" stroke="#083c3f" stroke-width="2" fill="none"/>
    </svg>
  </button>

  <!-- Repeat -->
  <button class="circle-btn" id="repeat" title="Repeat current" aria-label="Repeat">
    <svg viewBox="0 0 24 24">
      <path d="M7 7h10v3l4-4-4-4v3H5v6" fill="#083c3f"/>
      <path d="M17 17H7v-3l-4 4 4 4v-3h12v-6" fill="#083c3f"/>
    </svg>
  </button>

  <!-- Menu -->
  <button class="circle-btn" id="menuBtn" title="Menu / Playlist" aria-label="Menu / Playlist">
    <svg viewBox="0 0 24 24">
      <rect x="4" y="6" width="16" height="2"/>
      <rect x="4" y="11" width="16" height="2"/>
      <rect x="4" y="16" width="10" height="2"/>
    </svg>
  </button>

</div>

<main>
  <div class="content_main">
     <h4 style="font-size: clamp(10px, 5vw, 20px);color: red;text-align: center;">TRẬN CHIẾN ĐẤU THỌC SÂU ĐÁNH CHIẾM SÂN BAY TÂN SƠN NHẤT CỦA TRUNG ĐOÀN BỘ BINH 24 TRUNG DŨNG</h4>
  </div>

  <!-- ảnh bìa riêng cho đề mục 1 -->
  <img class="hero-img" src="./img/9.jpg" alt="Đề mục 1 - bìa">
 <h4 style="color:rgb(131, 8, 8); margin:4px 0;text-align: center;text-transform: uppercase;font-size: clamp(10px, 5vw, 20px);">Sa bàn trận đánh</h4>
  <div class="content">
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Kính thưa thủ trưởng,</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Kính thưa toàn thể các đồng chí!</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Thủ trưởng và các đồng chí đang tham quan sa bàn tái hiện trận chiến đấu thọc sâu đánh chiếm sân bay Tân Sơn Nhất trong Chiến dịch Hồ Chí Minh năm 1975 của Trung đoàn 24- Đoàn Trung Dũng.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: 700;">Về hoàn cảnh và tình hình trước trận đánh</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Cuối tháng 4 năm 1975, khi thời cơ chiến lược giải phóng hoàn toàn miền Nam đã chín muồi, Bộ Chính trị hạ quyết tâm mở Chiến dịch Hồ Chí Minh với phương châm chỉ đạo: “Thần tốc, táo bạo, bất ngờ, chắc thắng”. Trong thế trận tổng công kích vào Sài Gòn- Gia Định, sân bay Tân Sơn Nhất được xác định là một trong năm mục tiêu chủ yếu, bởi đây là căn cứ không quân lớn nhất của chính quyền Sài Gòn, trung tâm chỉ huy- tiếp vận chiến lược và cũng là con đường thoát thân cuối cùng của bộ máy đầu não ngụy quyền.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Sáng ngày 23 tháng 4 năm 1975, tại Sở Chỉ huy Quân đoàn 3, Thiếu tướng Vũ Lăng- Tư lệnh Quân đoàn chính thức giao nhiệm vụ cho Sư đoàn 10 thực hiện mũi thọc sâu chiến dịch, sử dụng lực lượng binh chủng hợp thành mạnh, cơ động cao đánh chiếm sân bay Tân Sơn Nhất, sau đó phát triển cùng đơn vị bạn đánh chiếm Bộ Tổng Tham mưu ngụy.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Theo kế hoạch hiệp đồng, Trung đoàn 24 đảm nhiệm hướng tiến công thọc sâu chủ yếu của Sư đoàn 10, từ phía nam- tây nam đánh vào sân bay Tân Sơn Nhất; chiếm Bộ Tư lệnh dù, Bộ Tư lệnh Sư đoàn 5 không quân, Bộ Tư lệnh không quân, khu cố vấn Mỹ, khu kỹ thuật và ra-đa; hiệp đồng với Trung đoàn 28 làm chủ hoàn toàn sân bay; bắt liên lạc và bảo vệ Ủy ban quốc tế cùng hai phái đoàn quân sự ta ở trại Đa-vít; sau đó sẵn sàng phát triển đánh chiếm Bộ Tổng Tham mưu và Biệt khu Thủ đô ngụy.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Ngày 27 tháng 4 năm 1975, tại Sở Chỉ huy dã chiến Dầu Tiếng, Trung đoàn tổ chức hội nghị quân chính, hoàn chỉnh phương án tác chiến. Toàn Trung đoàn được tổ chức thành bốn khối cơ động đột kích binh chủng hợp thành, với 1.896 cán bộ, chiến sĩ, 137 xe cơ giới cùng lực lượng tăng, pháo, cao xạ, công binh, trinh sát. Tất cả đều xác định rõ: đây là trận đánh có quy mô lớn nhất, phức tạp và ác liệt nhất trong suốt 30 năm chiến đấu của đơn vị.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">17 giờ ngày 26 tháng 4 năm 1975, Chiến dịch Hồ Chí Minh chính thức nổ súng. Sau khi Sư đoàn 320 tiêu diệt căn cứ Đồng Dù, cánh cửa phía tây bắc Sài Gòn được mở toang, thời cơ thọc sâu vào nội đô đã đến.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;font-weight: 700;">Diễn biến chính của trận đánh</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;font-weight: 700;">1. Hành tiến thọc sâu ngày 29 tháng 4 năm 1975</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Đúng 5 giờ 35 phút ngày 29 tháng 4, Trung đoàn trưởng Vũ Văn Tài nhận lệnh xuất kích. Sau 15 phút, khối đi đầu xuất phát; ba khối sau cơ động tiếp theo. Đoàn xe 137 chiếc, theo đội hình hàng dọc, vượt qua Củ Chi tiến về Sài Gòn.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">10 giờ 15 phút, khi còn cách quận lỵ Củ Chi khoảng 4 km, phát hiện địch chặn đường; xe tăng M48 của ta bắn cháy liền 5 xe địch, đội hình tiếp tục hành tiến.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">11 giờ 30 phút, tại Tân Phú Trung, Đại đội 7 cùng 9 xe tăng thiết giáp lao thẳng vào đội hình địch đang ùn lại. Sau 30 phút chiến đấu hiệp đồng chặt chẽ, ta bắn cháy và bắt 28 xe tăng, xe bọc thép, diệt nhiều sinh lực địch.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Từ 13 giờ, Trung đoàn đánh Thành Quan Năm; 16 giờ 30 phút vượt cầu Tham Lương; 18 giờ tiến đến nhà máy dệt Vi-na-tếch-cô, giáp phía tây sân bay Tân Sơn Nhất.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Tại đây, địch gồm một tiểu đoàn bảo an, một tiểu đoàn dù và một chi đội xe tăng lập tuyến phòng ngự mới. Trung đoàn sử dụng pháo 85 ly, cối 82 ly, xe tăng và cao xạ 37 ly đánh bật địch, chiếm ngã ba Bà Quẹo.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">21 giờ ngày 29 tháng 4, Bộ Tư lệnh Quân đoàn điện thông báo: Trung đoàn 24 là mũi thọc sâu vào Sài Gòn sớm nhất, vượt thời gian quy định.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Trong ngày 29 tháng 4, Trung đoàn bị thương vong 20 đồng chí nhưng vẫn giữ vững đội hình và khí thế tiến công.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;font-weight: 700;">2. Tổng công kích sáng 30 tháng 4 năm 1975</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">7 giờ 15 phút ngày 30 tháng 4, Tư lệnh Vũ Lăng ra lệnh tiến công. Pháo binh Quân đoàn và Sư đoàn 10 đồng loạt bắn cấp tập vào sân bay Tân Sơn Nhất. 8 giờ 30 phút, pháo 130 ly chiến dịch tham gia bắn phá.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Trung đoàn 24 được lệnh đánh chiếm ngã tư Bảy Hiền. Tiểu đoàn 5 có xe tăng hỗ trợ giao chiến ác liệt với Tiểu đoàn 8 dù và chi đội xe tăng địch. Đại đội 7 cùng 11 xe tăng thiết giáp dũng cảm đột kích mở đường. Đại đội trưởng Lê Hồng Tư anh dũng hy sinh khi chỉ huy xung phong. Hai chiến sĩ Tố và Việt dùng B40, AK táo bạo mở đường. Hai tiểu đoàn địch bị đánh bật, bỏ lại hàng chục xác chết và 10 xe tăng, ô tô bị cháy.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">8 giờ 45 phút, đội hình Tiểu đoàn 5 phát triển đến tây nam cổng số 5 sân bay. Địch dùng B90, ĐKZ, hỏa tiễn X202 chống trả dữ dội. Hai xe tăng và một xe K63 của ta bị cháy. Trung đoàn tăng cường 4 xe tăng và 2 khẩu pháo 85 ly chi viện. Sau một giờ chiến đấu dũng cảm, 9 giờ 45 phút ta chiếm được cổng số 5.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Các mũi nhanh chóng phát triển vào bên trong, đúng 10 giờ 30 phút bắt 57 tên địch, trong đó có 3 đại tá. 11 giờ cùng ngày chiếm hoàn toàn khu cố vấn, Sư đoàn 5 không quân; bắn cháy 1 máy bay L19; diệt và bắt nhiều sĩ quan, binh lính địch. 10 giờ 35 phút, lá cờ chiến thắng tung bay trên Bộ Tư lệnh không quân ngụy.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Cùng thời điểm, Tiểu đoàn 4 đánh chiếm Bộ Tư lệnh dù; Tiểu đoàn 6 đánh chiếm Bộ Tư lệnh không quân và trại Đa-vít, bắt liên lạc với phái đoàn quân sự ta. Đến 11 giờ 30 phút, sân bay Tân Sơn Nhất hoàn toàn thuộc quyền kiểm soát của ta.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: 700;">Kết quả, ý nghĩa lịch sử và bài học kinh nghiệm</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Trong hơn 30 giờ chiến đấu liên tục, vượt qua nhiều tuyến phòng ngự dày đặc và hỏa lực chống trả quyết liệt của địch, Trung đoàn 24 đã giành được thắng lợi to lớn, toàn diện. Ta tiêu diệt 427 tên địch, bắt 101 tên và làm tan rã hàng ngũ, phóng thích tại chỗ hơn 1.000 tên khác. Lực lượng phòng không và hỏa lực trực tiếp của đơn vị đã bắn rơi 2 máy bay; bắn cháy, phá hủy 9 xe tăng, xe bọc thép cùng 15 xe GMC của địch.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Đặc biệt, sau khi làm chủ hoàn toàn sân bay Tân Sơn Nhất, Trung đoàn đã thu hồi gần 400 máy bay các loại cùng toàn bộ trang bị kỹ thuật của sân bay; thu hơn 1.000 xe ô tô quân sự, trong đó có 7 xe bọc thép M113 và 1 xe tăng M48; thu hơn 1.300 khẩu súng bộ binh cùng hàng chục khẩu pháo lớn. Đây là khối lượng chiến lợi phẩm rất lớn, góp phần bổ sung nguồn trang bị cho ta và làm tê liệt hoàn toàn khả năng cơ động đường không của đối phương.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Trong chiến thắng vang dội đó, Trung đoàn 24 cũng phải chịu những tổn thất không nhỏ: 72 cán bộ, chiến sĩ anh dũng hy sinh, 113 đồng chí bị thương. Sự hy sinh cao cả của các đồng chí đã góp phần làm nên thắng lợi quyết định của trận đánh, viết tiếp truyền thống trong giờ phút lịch sử của dân tộc.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Chiến thắng đánh chiếm sân bay Tân Sơn Nhất đã trực tiếp làm tê liệt hoàn toàn khả năng cơ động đường không của chính quyền Sài Gòn, góp phần quyết định vào sự sụp đổ nhanh chóng của toàn bộ hệ thống phòng thủ nội đô, tạo điều kiện để các cánh quân tiến vào Dinh Độc Lập lúc 10 giờ 45 phút và làm chủ hoàn toàn Sài Gòn – Gia Định vào 11 giờ 30 phút ngày 30 tháng 4 năm 1975.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Chiến công đó đã làm rạng rỡ thêm truyền thống “Luôn luôn Trung Dũng”, ghi dấu mốc chói lọi trong 30 năm chiến đấu và trưởng thành của Trung đoàn 24, góp phần xứng đáng vào chiến thắng vĩ đại của dân tộc trong cuộc kháng chiến chống Mỹ cứu nước.</p>
    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">Trân trọng cảm ơn thủ trưởng và các đồng chí đã tham quan sa bàn tái hiện trận chiến đấu thọc sâu đánh chiếm sân bay Tân Sơn Nhất trong Chiến dịch Hồ Chí Minh năm 1975 của Trung đoàn 24- Đoàn Trung Dũng.</p>
  </div>
</main>

<!-- Fullscreen Playlist Overlay -->
<div class="playlist-overlay" id="playlistOverlay" aria-hidden="true" role="dialog" aria-label="Playlist">
  <div class="playlist-modal" role="document" id="playlistModal">
    <div class="playlist-header">
      <h4>Playlist</h4>
      <div>
        <button class="close-btn" id="closeBtn" aria-label="Đóng playlist">✕</button>
      </div>
    </div>

    <div class="playlist-body" id="playlistBody">
      <ul class="playlist-list" id="trackList">
        <!-- JS tạo danh sách -->
      </ul>
    </div>
  </div>
</div>

<!-- Audio element -->
<audio id="audio" preload="none"></audio>

<script>
/* === CHỈ SỬA / THÊM Ở ĐÂY: logic để trang biết mình đang ở mục nào và autoplay ===
   Mọi HTML/CSS bên ngoài không thay đổi.
*/

/* Danh sách bài đầy đủ (giữ cấu trúc page giống file của bạn) */
const tracks = [
  // ví dụ: track 1 có page -> khi prev/next tới track 1 sẽ điều hướng
  { title: "Giới thiệu tổng quan", src: "./audio/giới thiệu.mp3", content:"Giới thiệu", page: "./gioithieu.html" },
  { title: "Đề mục 1- Không gian khánh tiết", src: "./audio/3. Đề mục 1- Không gian khánh tiết.mp3", content:"Không gian khánh tiết", page: "./khonggiankhanhtiet.html" },
  { title: "Đề mục 2- Lịch sử hình thành, phát triển Trung đoàn", src: "./audio/4. Đề mục 2- Lịch sử hình thành, phát triển Trung đoàn.mp3", content:"Giới thiệu", page: "lichsuhinhthanh.html" },
  { title: "Mảng ảnh 1- Đề mục 2 giai đoạn 1946-1954",  src: "./audio/5. Mảng ảnh 1- Đề mục 2.mp3",  content:"Đề mục 1", page: "./demuc1.html" },
  { title: "Mảng ảnh 2- Đề mục 2 giai đoạn 1955-1971",  src: "./audio/6. Mảng ảnh 2- Đề mục 2.mp3", content:"Đề mục 2", page: "./demuc2.html" },
  { title: "Mảng ảnh 3- Đề mục 2 giai đoạn 1971-1975",  src: "./audio/7. Mảng ảnh 3- Đề mục 2.mp3",  content:"Đề mục 3", page: "./demuc3.html" },
  { title: "Mảng ảnh 4- Đề mục  giai đoạn 1976-1979",  src: "./audio/8. Mảng ảnh 4- Đề mục 2.mp3", content:"Đề mục 4", page: "./demuc4.html" },
  { title: "Mảng ảnh 5- Đề mục 2 giai đoạn 1979-1988",  src: "./audio/9. Mảng ảnh 5- Đề mục 2.mp3",  content:"Đề mục 5", page: "./demuc5.html" },
  { title: "Mảng ảnh 6- Đề mục 2 giai đoạn 1988-2020",  src: "./audio/10. Mảng ảnh 6- Đề mục 2.mp3", content:"Đề mục 6", page: "./demuc6.html" },
  { title: "Mảng ảnh 7- Đề mục 2 giai đoạn 2020 đến nay",  src: "./audio/11. Mảng ảnh 7- Đề mục 2.mp3",  content:"Đề mục 7", page: "./demuc7.html" },
  { title: "Đề mục 3- Trận đánh điểm diệt viện",  src: "./audio/12. Đề mục 3- Trận đánh điểm diệt viện.mp3", content:"sa bàn", page: "./saban.html" },
  { title: "Đề mục 3- Trận đánh Sân bay Tân Sơn Nhất",  src: "./audio/13. Đề mục 3- Trận đánh Sân bay Tân Sơn Nhất.mp3", content:"tân sơn nhất", page: "./tansonnhat.html" },
  { title: "Đề mục 4- Hiện vật lịch sử",  src: "./audio/14. Đề mục 4- Hiện vật lịch sử .mp3", content:"tân sơn nhất", page: "./hienvatlichsu.html" },
  { title: "Đề mục 5- Phần thưởng cao quý",  src: "./audio/15. Đề mục 5- Phần thưởng cao quý.mp3", content:"tân sơn nhất", page: "./phanthuongcaoquy.html" },
];

/* DOM elements (không đổi) */
const audio = document.getElementById("audio");
const playBtn = document.getElementById("play");
const playIcon = document.getElementById("playIcon");
const repeatBtn = document.getElementById("repeat");
const prevBtn = document.getElementById("prev");
const nextBtn = document.getElementById("next");
const volumeBtn = document.getElementById("volumeBtn");
const menuBtn = document.getElementById("menuBtn");

const playlistOverlay = document.getElementById("playlistOverlay");
const playlistModal = document.getElementById("playlistModal");
const closeBtn = document.getElementById("closeBtn");
const trackListEl = document.getElementById("trackList");

let currentIndex = 0;
let isRepeat = false;

/* Helper: lấy tên file hiện tại (không bao gồm query string) */
function currentFilename() {
  const path = location.pathname;
  const file = path.split('/').pop();
  return file || 'index.html';
}

/* Helper: đọc query param */
function getQueryParam(name) {
  return new URLSearchParams(location.search).get(name);
}

/* Helper: thêm ?autoplay=1 nếu cần */
function addAutoplayParam(page, autoplay) {
  if (!autoplay) return page;
  return page + (page.includes('?') ? '&' : '?') + 'autoplay=1';
}

/* --- render playlist (giữ giống cấu trúc ban đầu) --- */
function renderPlaylist() {
  trackListEl.innerHTML = "";
  tracks.forEach((t, i) => {
    const li = document.createElement("li");
    li.dataset.index = i;

    const info = document.createElement("div");
    info.className = "track-info";

    const title = document.createElement("div");
    title.className = "track-title";
    title.textContent = t.title + (t.page ? " ▸" : "");

    const sub = document.createElement("div");
    sub.className = "track-sub";
    sub.textContent = `Bài ${i+1}`;

    info.appendChild(title);
    info.appendChild(sub);

    const btns = document.createElement("div");
    btns.style.display = "flex";
    btns.style.gap = "8px";
    btns.style.alignItems = "center";

    const playNow = document.createElement("button");
    playNow.className = "circle-btn";
    playNow.style.width = "40px";
    playNow.style.height = "40px";
    playNow.title = "Phát";
    playNow.ariaLabel = "Phát";
    playNow.innerHTML = '<svg viewBox="0 0 24 24" style="width:18px;height:18px;fill:#083c3f;"><polygon points="8,5 19,12 8,19"/></svg>';
    playNow.addEventListener("click", (ev) => {
      ev.stopPropagation();
      loadTrack(i, true);
    });

    btns.appendChild(playNow);
    li.appendChild(info);
    li.appendChild(btns);

    li.addEventListener("click", () => {
      const track = tracks[i];
      if (track.page) {
        // nếu có page -> điều hướng kèm autoplay để trang đích tự phát
        window.location.href = addAutoplayParam(track.page, true);
      } else {
        loadTrack(i, true);
        closePlaylist();
      }
    });

    trackListEl.appendChild(li);
  });
}

/* Highlight hiện tại */
function highlightCurrent() {
  const items = trackListEl.querySelectorAll("li");
  items.forEach(li => li.classList.remove("active"));
  const cur = trackListEl.querySelector(`li[data-index="${currentIndex}"]`);
  if (cur) cur.classList.add("active");
}

/* Load track theo index */
function loadTrack(index, playNow = false) {
  if (index < 0 || index >= tracks.length) return;
  currentIndex = index;
  audio.src = tracks[currentIndex].src;
  highlightCurrent();
  if (playNow) {
    audio.play().catch(()=>{/* bị chặn autoplay có thể xảy ra */});
    setPlayIcon(true);
  } else {
    setPlayIcon(false);
  }
}

/* Play/pause */
function togglePlay() {
  if (audio.paused) {
    audio.play().catch(()=>{});
    setPlayIcon(true);
  } else {
    audio.pause();
    setPlayIcon(false);
  }
}

/* Hiển thị icon play/pause */
function setPlayIcon(playing) {
  if (playing) {
    playIcon.innerHTML = '<rect x="7" y="6" width="3" height="12"/><rect x="14" y="6" width="3" height="12"/>';
  } else {
    playIcon.innerHTML = '<polygon points="8,5 19,12 8,19"/>';
  }
}

/* Prev/Next: wrap-around; nếu target có page -> điều hướng kèm autoplay */
function prevTrack(){
  let newIndex = currentIndex - 1;
  if (newIndex < 0) newIndex = tracks.length - 1; // wrap to last
  const target = tracks[newIndex];
  if (target && target.page) {
    window.location.href = addAutoplayParam(target.page, true);
  } else {
    loadTrack(newIndex, true);
  }
}

function nextTrack(){
  let newIndex = currentIndex + 1;
  if (newIndex >= tracks.length) newIndex = 0; // wrap to first
  const target = tracks[newIndex];
  if (target && target.page) {
    window.location.href = addAutoplayParam(target.page, true);
  } else {
    loadTrack(newIndex, true);
  }
}

/* Khi audio kết thúc */
audio.addEventListener("ended", ()=>{
  if (isRepeat) {
    audio.currentTime = 0;
    audio.play();
    return;
  }
  const nextIndex = (currentIndex + 1) % tracks.length;
  const target = tracks[nextIndex];
  if (target && target.page) {
    window.location.href = addAutoplayParam(target.page, true);
  } else {
    loadTrack(nextIndex, true);
  }
});

/* Repeat toggle */
repeatBtn.onclick = ()=> {
  isRepeat = !isRepeat;
  audio.loop = false;
  repeatBtn.style.background = isRepeat ? "rgba(255,255,255,0.6)" : "rgba(255,255,255,0.25)";
};

/* Hook up buttons */
playBtn.onclick = togglePlay;
prevBtn.onclick = prevTrack;
nextBtn.onclick = nextTrack;

volumeBtn.onclick = ()=> {
  audio.muted = !audio.muted;
  volumeBtn.style.background = audio.muted ? "rgba(255,255,255,0.6)" : "rgba(255,255,255,0.25)";
};

/* Playlist open/close */
menuBtn.onclick = (e)=> { e.stopPropagation(); openPlaylist(); };
closeBtn.onclick = (e)=> { e.stopPropagation(); closePlaylist(); };

function openPlaylist(){
  playlistOverlay.classList.add("open");
  playlistOverlay.setAttribute("aria-hidden", "false");
  closeBtn.focus();
}

function closePlaylist(){
  playlistOverlay.classList.remove("open");
  playlistOverlay.setAttribute("aria-hidden", "true");
  menuBtn.focus();
}

/* Click ngoài modal đóng */
playlistOverlay.addEventListener("click", (e) => {
  if(!playlistModal.contains(e.target)) closePlaylist();
});
playlistModal.addEventListener("click", (e) => e.stopPropagation());

/* Keyboard */
document.addEventListener("keydown", (e)=>{
  if(e.code === "Space") { e.preventDefault(); togglePlay(); }
  else if (e.key && e.key.toLowerCase() === "m") { audio.muted = !audio.muted; volumeBtn.style.background = audio.muted ? "rgba(255,255,255,0.6)" : "rgba(255,255,255,0.25)"; }
  else if (e.code === "ArrowRight") nextTrack();
  else if (e.code === "ArrowLeft") prevTrack();
  else if (e.code === "Escape" && playlistOverlay.classList.contains("open")) closePlaylist();
});

/* === INIT: render playlist, detect current page, set currentIndex, autoplay nếu có param === */
function init() {
  renderPlaylist();

  const file = currentFilename(); // ex: demuc1.html
  // tìm track có page trùng file (so sánh basename)
  const idx = tracks.findIndex(t => t.page && t.page.split('/').pop() === file);
  currentIndex = (idx >= 0) ? idx : 0;

  highlightCurrent();

  const shouldAuto = getQueryParam('autoplay') === '1';
  loadTrack(currentIndex, shouldAuto);
}

init();

/* === KẾT THÚC PHẦN SCRIPT SỬA === */
</script>

</body>
</html>
